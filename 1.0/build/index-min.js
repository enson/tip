/*! tip - v1.0 - 2013-05-23 9:19:01 AM
* Copyright (c) 2013 xijian.py; Licensed  */
KISSY.add("gallery/tip/1.0/node-extension",function(t,e,n){"use strict";t.augment(t.Node,{beyondViewPortRegion:function(e){function i(t,e){return t>=c+o&&c+a-o>=t&&e>=f+o&&f+s-o>=e?!0:!1}var o,r=this;o=t.isUndefined(e)?0:e;var s,a,c,f,u=r.offset();return s=n.viewportHeight(),a=n.viewportWidth(),c=n.scrollLeft(),f=n.scrollTop(),{start:i(u.left,u.top),end:i(u.left+r.width(),u.top+r.height())}},inViewportRegion:function(t){var e=this,n=e.beyondViewPortRegion(t);return n.start&&n.end?!0:!1}})},{requires:["node","dom"]}),KISSY.add("gallery/tip/1.0/index",function(t){"use strict";t.Node.all;var e=t.Overlay,n=[["tc","bc","bc"],["bc","tc","tc"],["tl","br",""],["tl","bl","bl"],["bl","tr",""],["bl","br","rb"],["bl","tl","tl"],["br","tl",""],["br","bl","lb"],["br","tr","tr"],["tr","br","br"],["tr","bl",""],["tr","tl","lt"],["cr","cl","lc"],["tl","tr","rt"],["cl","cr","rc"]],i=['<div class="z-tip">','<span class="z-taper"></span>','<span class="z-close">x</span>','<div class="z-wrapper">','<div class="hd">',"</div>",'<div class="bd">',"</div>","</div>","</div>"].join(""),o=[],r=function(){this._init.apply(this,arguments)};return t.augment(r,t.Event.Target,{_init:function(e,n){var i=this;return t.isString(e)&&(e=t.one(e)),i.target=e,i._buildParam(n),i._buildHtml(),i._bindEvent(),this.firstShow=!0,this},_bringToTop:function(){var t=this;return t.con.css("z-index",t.zIndex++),this},setContent:function(e){var n=this;return t.isString(e)?n.con.one(".bd").html(e):n.con.one(".bd").empty().append(e),this},setHeader:function(t){var e=this;return e.con.one(".hd").html("<b>"+t+"</b>"),this},_buildHtml:function(){var n=this,o=t.Node(i);return o.css({visibility:"hidden",position:"absolute"}).appendTo(t.one("body")),n.con=o,n.popup=new e.Popup({srcNode:o,align:{node:n.target,points:n.points,offset:[n.offsetX,n.offsetY]},effect:{effect:n.effect,duration:n.duration}}),n.useTitle&&n._getTitleAsData(),n.display=n.con.css("display"),n.tipClass&&(n.con.addClass(n.tipClass),n.con.removeClass("z-tip")),n.closeable&&n.con.one(".z-close").css("display","block"),this},rePosition:function(){var t=this,e=t.popup.get("align");return t.popup.align(t.target,e.points,e.offset),t.arrow&&t.renderArrow(),this},_getTitleAsData:function(){var t=this,e=t.target.attr("title");return""!==e&&(t.target.attr("data-title",e),t.target.attr("title","")),t.target.attr("data-title")},_bindEvent:function(){var e=this;return t.each(e.showOn,function(t){e.target.on(t,function(t){e.hiddingTimer&&clearTimeout(e.hiddingTimer),e.isShowing()||(t.preventDefault(),e.showingTimer=setTimeout(function(){e.show()},e.delayIn))})}),t.each(e.hideOn,function(t){e.target.on(t,function(){e.showingTimer&&clearTimeout(e.showingTimer),e.isShowing()&&(e.hiddingTimer=setTimeout(function(){e.hide()},e.delayOut))})}),e.con.one(".z-close").on("click",function(){e.hide()}),e.mouseHook&&t.Event.on("body","mousemove",function(t){o=[t.pageX,t.pageY],e.withMouseMove&&e._positionWithMouse()}),e.hideOnEmptyClick&&t.Event.on(document,"click",function(t){t.target==e.con.getDOMNode()||t.target==e.target.getDOMNode()||e.target.contains(t.target)||e.con.contains(t.target)||e.hide()}),t.Event.on(window,"resize",function(){e.rePosition(),e.rerender(),e.renderArrow()}),e.fleeting||(e.con.on("mouseenter",function(){e.hiddingTimer&&clearTimeout(e.hiddingTimer)}),e.con.on("mouseleave",function(){e.hiddingTimer=setTimeout(function(){e.hide()},e.delayOut)})),this},isShowing:function(){var t=this;return"hidden"!=t.con.css("visibility")?!0:!1},hide:function(){var t=this;return t.fire("beforeHide")===!1?this:(t.popup.hide(),t.con.css("display","none"),t.fire("afterHide"),t.fire("hide"),t._teardown(),this)},_teardown:function(){var e=this;return function(){if(e.arrow&&e._arrowPos&&""!==e._arrowPos){var n=t.clone(e.popup.get("align"));switch(e._arrowPos.charAt(0)){case"l":n.offset[0]-=e.aOffset;break;case"r":n.offset[0]+=e.aOffset;break;case"t":n.offset[1]-=e.aOffset;break;case"b":n.offset[1]+=e.aOffset}e.popup.align(e.target,n.points,n.offset)}}(),this},_renderContent:function(t){var e=this,n=t?t:e.contentText?e.contentText:e.getConentText.call(e,e.target),i=e.headerText?e.headerText:e.getHeaderText.call(e,e.target);return n&&e.setContent(n),i&&e.setHeader(i),this},_positionWithMouse:function(){var t=this;return t.popup.set("x",o[0]-4+t.offsetX),t.popup.set("y",o[1]+20+t.offsetY),this},show:function(t){var e=this;return e.fire("beforeShow")===!1?this:(e.con.css("display",e.display),e.staticContent?(e.firstShow&&e._renderContent(t),e.firstShow=!1):e._renderContent(t),e.con.css("visibility","hidden"),e.popup.show(),e.con.css("visibility",""),e.fire("afterShow"),e.fire("show"),e.mouseHook&&e._positionWithMouse(),e.smarty&&e.smartyPosition(),e.arrow&&e.renderArrow(),e._bringToTop(),this)},_getArrowPos:function(){for(var t,e=this,i=e.popup.get("align"),o=0;n.length>o;o++)if(n[o][0]==i.points[0]&&n[o][1]==i.points[1]){t=n[o][2];break}return t},renderArrow:function(){var e=this;if(!e.arrow)return this;if(t.each(n,function(t){e.con.removeClass(t[2])}),e.mouseHook)return this;var i=e._getArrowPos();if(e._arrowPos=i,""===i)return this;36>=e.con.height()&&("l"==i.charAt(0)||"r"==i.charAt(0))&&(i=i.charAt(0)+"c"),36>=e.con.width()&&("t"==i.charAt(0)||"b"==i.charAt(0))&&(i=i.charAt(0)+"c"),e.con.addClass(i),e.popup.get("x"),e.popup.get("y");var o=t.clone(e.popup.get("align"));switch(i.charAt(0)){case"l":o.offset[0]+=e.aOffset;break;case"r":o.offset[0]-=e.aOffset;break;case"t":o.offset[1]+=e.aOffset;break;case"b":o.offset[1]-=e.aOffset}return e.popup.align(e.target,o.points,o.offset),this},rerender:function(){var t=this;return t.smartyPosition(),this},smartyPosition:function(){function t(){if(!e.con.inViewportRegion(0)&&0!==i.length){var n=i.pop();e.popup.set("align",{node:e.target,points:n,offset:[e.offsetX,e.offsetY]}),e.arrow&&(e.renderArrow(),e.revise(e._getArrowPos())),t()}}var e=this;if(e.mouseHook||(console.log(e.target),e.popup.set("align",{node:e.target,points:e.points,offset:[e.offsetX,e.offsetY]})),!e.smarty)return this;var i=n.concat().reverse();t()},_buildParam:function(e){function n(t,n){var i=e[n];o[n]=void 0===i||null===i?t:i}function i(e){t.isString(o[e])&&(o[e]=[o[e]])}var o=this;(void 0===e||null===e)&&(e={}),t.each({delayIn:300,delayOut:100,showOn:"mouseenter",hideOn:"mouseleave",hideOnEmptyClick:!0,revise:function(){},zIndex:100,aOffset:7,withMouseMove:!1,contentText:!1,headerText:!1,getHeaderText:function(){return""},staticContent:!1,useTitle:!0,dataSegment:"title",effect:"fade",points:["bc","tc"],mouseHook:!0,fleeting:!0,duration:.2,tipClass:"",smarty:!0,closeable:!1,arrow:!0,showLoading:!0,offsetX:0,offsetY:0},n);var r=function(){};return r=function(t){var e=t.attr(o.dataSegment);return""!==e&&(t.attr(o.dataSegment,""),t.attr("data-title",e)),t.attr("data-title")},t.each({getConentText:r},n),t.each(["showOn","hideOn"],i),8>=t.UA.ie&&(o.effect="none"),this}}),r},{requires:["overlay","./node-extension"]});